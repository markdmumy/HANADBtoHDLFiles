How To Export/Import data from HANA Cloud, HANA database (HDB) to HANA Cloud, data lake files (HDLFS)

Use this manual as a primer: https://help.sap.com/viewer/f9c5015e72e04fffa14d7d4f7267d897/2022_1_QRC/en-US/462c861413b043bd93b9e8e838249b6e.html

Basic steps, SQL issued in HDB:
•	Create PSE
•	Add certificate to PSE
•	Add the certificate to the PSE
•	Add the HDLFS certificate to the PSE
•	Create a HANA Import/Export Credential that maps to the PSE (and by extension the certificates

Create PSE
drop PSE MYPSE cascade;
Create PSE MYPSE;
Add certificate to PSE
	must use DigiCert certificate.
	download PEM version of the DigiCert Global Root CA from this site: https://www.digicert.com/kb/digicert-root-certificates.htm
	thie file: https://cacerts.digicert.com/DigiCertGlobalRootCA.crt.pem
	this CREATE CERT should work for all HANA clouds as this is the above PEM file.
CREATE CERTIFICATE FROM '<insert cert here>' COMMENT 'HDLFS';

Once created, you need to get the certificate ID as that’s used to reference it:
SELECT CERTIFICATE_ID FROM CERTIFICATES WHERE COMMENT = 'HDLFS';
Add the certificate to the PSE
ALTER PSE MYPSE ADD CERTIFICATE <certID_from_above>;

Add the HDLFS certificate to the PSE
These files are generated by you or given to you by a security administrator.
Follow this process to generate the files using OpenSSL on any host with OpenSSL installed:
openssl genrsa -out ca.key 2048
openssl req -x509 -new -key ca.key -days 9999 -out ca.crt
openssl req -new -nodes -newkey rsa:2048 -out client.csr -keyout client.key
openssl x509 -days 9999 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt

openssl verify -CAfile ca.crt client.crt

openssl x509 -in client.crt -in client.crt -nameopt RFC2253 -subject -noout
Add these certificates to your HANA PSE.  There are three files, and thus three sections that must be included between the single quotes below:
ALTER PSE MYPSE SET OWN CERTIFICATE '<files here>';

For <files here> use the full contents of these files (including the BEGIN/END comments):
	client.key
	client.crt
	ca.crt

Create a HANA Import/Export Credential that maps to the PSE (and by extension the certificates
CREATE CREDENTIAL FOR USER DBADMIN COMPONENT 'SAPHANAIMPORTEXPORT' PURPOSE 'myCredential' TYPE 'X509' PSE 'MYPSE';

Test it out
create table EXPORT_TEST as ( select * from dummy );
insert into EXPORT_TEST select * from EXPORT_TEST;
insert into EXPORT_TEST select * from EXPORT_TEST;

export EXPORT_TEST as parquet into 'hdlfs://489c1954-1b6b-47c8-9cfd-aa6353b0e483.files.hdl.canary-eu10.hanacloud.ondemand.com/hana_export_test/xxx'
WITH CREDENTIAL 'myCredential'
;

drop table EXPORT_TEST;

See files in HDLFS using hdlfscli
Using hdlfscli (or curl or HANA Cloud Database Explorer) you can see the files exported:
hdlfscli -k -cert client.crt -key client.key -cacert ca.crt -s hdlfs://489c1954-1b6b-47c8-9cfd-aa6353b0e483.files.hdl.canary-eu10.hanacloud.ondemand.com “ls hana_export_test/xxx/index/DBADMIN/EX/EXPORT_TEST”

Outputs this:
FILE      nobody nogroup           93 666  create.sql
FILE      nobody nogroup          200 666  data.parquet
FILE      nobody nogroup          605 666  export_system.info
FILE      nobody nogroup         2176 666  table.xml
